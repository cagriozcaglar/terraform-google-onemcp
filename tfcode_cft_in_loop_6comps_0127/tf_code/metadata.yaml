# autogen: Autogenerated from Terraform code.
#
# KRM-style metadata for a Terraform blueprint.
# For more info, see https://docs.google.com/document/d/1uMhNixV5RsH3s21pniLZpQDkSLS2cABh2lo1fkq2hMY/edit?tab=t.0#heading=h.5xgw4151le88
apiVersion: blueprints.cloud.google.com/v1alpha1
kind: BlueprintMetadata
metadata:
  name: terraform-google-management-project
  annotations:
    config.kubernetes.io/local-config: "true"
spec:
  info:
    title: GCP Management Project
    source:
      repo: https://github.com/GoogleCloudPlatform/terraform-google-management-project # Example source repo
      type: git
    version: 1.0.0 # Example version
    actuationTool:
      flavor: terraform
      version: ">= 1.3"
    description:
      tagline: A Terraform module to bootstrap a secure management project in Google Cloud.
      detailed: This module provisions a dedicated Google Cloud project designed for management and administrative tasks. It configures a centralized logging sink to a GCS bucket, creates a dedicated service account for Terraform automation with appropriate administrative permissions, and grants access to a specified admin group.
    examples:
      - name: simple_example
        location: examples/simple
  content:
    variables:
      - name: admin_group_email
        description: The email of the Google Group that will be granted administrative access to the management project. E.g., 'gcp-admins@example.com'. If not provided, no group will be granted access.
        type: String
        default: ""
        required: false
      - name: billing_account
        description: The ID of the billing account to associate with the management project. If not provided, the project will be created without a billing account.
        type: String
        default: null
        required: false
      - name: folder_id
        description: The ID of the folder to create the management project in. If not provided, `org_id` must be specified.
        type: String
        default: null
        required: false
      - name: force_destroy_log_bucket
        description: If set to true, allows the deletion of the log GCS bucket even if it's not empty. This is useful for testing environments.
        type: Boolean
        default: false
        required: false
      - name: log_bucket_location
        description: The location for the centralized log sink GCS bucket.
        type: String
        default: "US"
        required: false
      - name: log_retention_days
        description: The number of days to retain logs in the GCS bucket before deletion.
        type: Number
        default: 3650
        required: false
      - name: org_id
        description: The organization ID where the management project will be created. Used only if `folder_id` is not specified.
        type: String
        default: null
        required: false
      - name: project_name_prefix
        description: A prefix for the name and ID of the OneMCP management project. Must be 21 characters or less.
        type: String
        default: "onemcp-management"
        required: false
      - name: terraform_service_account_id
        description: The ID for the Terraform service account to be created. Must be between 6 and 30 characters.
        type: String
        default: "tf-onemcp-admin"
        required: false
    outputs:
      - name: log_sink_bucket_name
        description: The name of the GCS bucket created for centralized logging.
      - name: log_sink_writer_identity
        description: The service account identity that writes logs to the GCS bucket.
      - name: management_project_id
        description: The unique ID of the created OneMCP management project.
      - name: terraform_service_account_email
        description: The email address of the service account created for Terraform automation.
  requirements:
    roles:
      - level: Folder
        roles:
          - roles/resourcemanager.projectCreator
      - level: Organization
        roles:
          - roles/resourcemanager.projectCreator
      - level: Billing
        roles:
          - roles/billing.user
    services:
      - cloudresourcemanager.googleapis.com
      - serviceusage.googleapis.com
      - iam.googleapis.com
      - logging.googleapis.com
      - storage.googleapis.com
      - cloudbilling.googleapis.com
      - compute.googleapis.com
      - container.googleapis.com
      - sqladmin.googleapis.com
      - pubsub.googleapis.com
      - cloudfunctions.googleapis.com
      - run.googleapis.com
